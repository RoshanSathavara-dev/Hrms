@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager



@{
    var user = await UserManager.GetUserAsync(User);
    var fullName = user != null ? user.UserName : "Guest"; // Change `UserName` to `FullName` if stored
}




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HRMS Portal - @ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <!-- In your head section -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #2980b9;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }

        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            }

        .card-header {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            border-radius: 10px 10px 0 0 !important;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

            .btn-primary:hover {
                background-color: var(--accent-color);
                border-color: var(--accent-color);
            }

        .attendance-clock {
            font-size: 2.5rem;
            font-weight: 300;
        }

        .badge-attendance {
            font-size: 0.9rem;
            padding: 0.5em 0.75em;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="#">
                    
                    <i class="fas fa-user-tie me-2"></i><img src="~/uploads/profile/KALPHR.png" alt="KALPHR Logo" style="height: 48px;" />
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        @if (SignInManager.IsSignedIn(User))
                        {
                        <li class="nav-item">
                            <a class="nav-link active" asp-controller="Home" asp-action="Index"><i class="fas fa-home me-1"></i> Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Attendance" asp-action="AttendanceLog">
                                    <i class="fas fa-calendar-check me-1"></i>Attendance Log
                                </a>
                        </li>
                        <li class="nav-item">
                                <a class="nav-link active" asp-controller="Profile" asp-action="Index">My Profile</a>
                        </li>
                            <li class="nav-item">
                                <a class="nav-link active" asp-controller="Calendar" asp-action="Index">Calender</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="LeaveRequest" asp-action="MyLeaveBalances">
                                    <i class="fas fa-calendar-check nav-icon"></i>
                                    My Leave Balance
                                </a>
                            </li>
                              <li class="nav-item">
                                <a class="nav-link" asp-controller="Announcement" asp-action="Index">
                                    <i class="fas fa-bullhorn me-1"></i> Announcements
                                </a>
                            </li>

                        <!-- ✅ User Dropdown Menu -->

                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-circle me-1"></i> @fullName
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <form asp-controller="Account" asp-action="Logout" method="post">
                                            <button type="submit" class="dropdown-item text-danger"><i class="fas fa-sign-out-alt me-2"></i>Logout</button>
                                        </form>
                                    </li>

                                </ul>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item">
                                <a class="nav-link btn btn-primary text-white" asp-controller="Account" asp-action="Login">Login</a>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <main role="main">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted mt-5">
        <div class="container py-3 text-center">
            &copy; @DateTime.Now.Year - HRMS Portal | <small>v1.0.0</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <!-- Bootstrap Notifications Container -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
        <div id="notificationContainer"></div>
    </div>
</body>
</html>

<script>
    // Force logout when browser/tab closes
// Only trigger silent logout if RememberMe is not checked
window.addEventListener('beforeunload', function() {
    const rememberMe = document.querySelector('input[name="RememberMe"]:checked');
    if (!rememberMe) {
        fetch('/Account/SilentLogout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include' // Important for cookies
        });
    }
});
    function showBootstrapAlert(type, message, duration = 5000) {
        // Create alert div
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.role = 'alert';
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        // Add to container
        const container = document.getElementById('notificationContainer');
        container.appendChild(alertDiv);

        // Auto-remove after duration
        setTimeout(() => {
            const bsAlert = bootstrap.Alert.getOrCreateInstance(alertDiv);
            bsAlert.close();
        }, duration);
    }
</script>