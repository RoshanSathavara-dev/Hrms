@model Hrms_system.Models.Address

<div class="modal-header">
    <h5 class="modal-title">@(Model.Id == 0 ? "Add Address" : "Edit Address")</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <form id="addEditAddressForm" asp-action="@(Model.Id == 0 ? "AddAddress" : "EditAddress")" method="post">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="CompanyId" value="@ViewBag.CompanyId" />

        @if (Model.Id == 0)
        {
            <div class="mb-3">
                <label asp-for="AddressType" class="form-label">Address Title</label>
                <input asp-for="AddressType" class="form-control" placeholder="Enter address title (e.g., Branch Office, Warehouse, Factory)" />
                <span asp-validation-for="AddressType" class="text-danger"></span>
            </div>
        }
        else
        {
            <div class="mb-3">
                <label asp-for="AddressType" class="form-label">Address Title</label>
                <input asp-for="AddressType" class="form-control" readonly />
            </div>
        }

        <div class="row">
            <div class="col-md-12 mb-3">
                <label asp-for="AddressLine1" class="form-label"></label>
                <input asp-for="AddressLine1" class="form-control" placeholder="Street address, P.O. box, company name" />
                <span asp-validation-for="AddressLine1" class="text-danger"></span>
            </div>
            <div class="col-md-12 mb-3">
                <label asp-for="AddressLine2" class="form-label"></label>
                <input asp-for="AddressLine2" class="form-control" placeholder="Apartment, suite, unit, building, floor, etc." />
                <span asp-validation-for="AddressLine2" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-3">
                <label asp-for="City" class="form-label"></label>
                <input asp-for="City" class="form-control" placeholder="City" />
                <span asp-validation-for="City" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-3">
                <label asp-for="State" class="form-label"></label>
                <select asp-for="State" class="form-select" id="stateSelect">
                    <option value="">Select State</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                    <option value="Ladakh">Ladakh</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Puducherry">Puducherry</option>
                </select>
                <span asp-validation-for="State" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-3">
                <label asp-for="Country" class="form-label"></label>
                <input asp-for="Country" class="form-control" placeholder="Country" value="India" readonly />
                <span asp-validation-for="Country" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-3">
                <label asp-for="Pincode" class="form-label"></label>
                <input asp-for="Pincode" class="form-control" placeholder="Postal/ZIP code" />
                <span asp-validation-for="Pincode" class="text-danger"></span>
            </div>
        </div>
    </form>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <button type="button" class="btn btn-admin" id="saveAddressBtn">Save Address</button>
</div>

<style>
    .modal-body {
        padding: 1.5rem;
    }

    .form-label {
        font-weight: 500;
        color: #495057;
    }

    .form-control, .form-select {
        border-radius: 0.375rem;
    }

        .form-control:focus, .form-select:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

    .modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid #dee2e6;
    }

    .btn-admin {
        background-color: #0d6efd;
        color: white;
    }

        .btn-admin:hover {
            background-color: #0b5ed7;
            color: white;
        }
</style>

<script>
    $(document).ready(function() {
        // Set India as the default country and make it readonly
        $('#Country').val('India').prop('readonly', true);

        // Handle form submission
        $('#saveAddressBtn').click(function() {
            var form = $('#addEditAddressForm');
            var country = $('#Country').val();

            if (country !== 'India') {
                alert('Only Indian addresses are allowed.');
                return;
            }

            var state = $('#stateSelect').val();
            if (!state) {
                alert('Please select a state.');
                return;
            }

            var addressType = $('#AddressType').val();
            if (!addressType) {
                alert('Please enter an address title.');
                return;
            }

            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                success: function(response) {
                    if (response.success) {
                        $('#addEditAddressModal').modal('hide');
                        window.location.href = window.location.pathname + '?tab=address' + (window.location.search ? '&' : '') + '_t=' + new Date().getTime();
                    } else {
                        $('#addEditAddressModalContent').html(response);
                    }
                },
                    error: function(xhr, status, error) {
                    if (xhr.status === 401) {
                        // If unauthorized, show a message and refresh the page
                        alert('Your session has expired. Please try again.');
                        window.location.reload();
                    } else {
                        alert("An error occurred while saving the address. Please try again.");
                    }
                }
            });
        });
    });
</script>