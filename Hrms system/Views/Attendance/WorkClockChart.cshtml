@model IEnumerable<Hrms_system.Models.Attendance>

@{
    ViewData["Title"] = "Work Time Clock Chart";
}

<div class="container mt-4">
    <h2><i class="fas fa-chart-pie me-2"></i> Work Time Clock Chart</h2>

    <canvas id="workClockChart" width="400" height="400"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var ctx = document.getElementById("workClockChart").getContext("2d");

        // ✅ Ensure Razor generates a valid JSON array
    var workHours = @Html.Raw(Json.Serialize(Model.Select(a => new
        {
            ClockIn = a.ClockIn.ToString("HH:mm"),
            ClockOut = a.ClockOut.HasValue ? a.ClockOut.Value.ToString("HH:mm") : "Still Working"
        }).ToList()))

        console.log("Work Hours Data:", workHours); // ✅ Debugging output

        var workTimeData = workHours.map(entry => {
            // ✅ Check for correct property casing
            if (!entry.ClockIn || entry.ClockIn === "00:00") {
                console.warn("Invalid ClockIn value:", entry);
                return null;
            }

            // ✅ Ensure property names match exactly (`ClockIn`, `ClockOut`)
            var clockInHour = parseInt(entry.ClockIn.split(":")[0]) % 12 || 12; // Convert 24-hour to 12-hour format

            return {
                label: `Clock In: ${entry.ClockIn} - Clock Out: ${entry.ClockOut}`,
                data: [clockInHour, 3, 6, 9, 12],
                backgroundColor: "rgba(75, 192, 192, 0.5)"
            };
        }).filter(item => item !== null); // ✅ Remove null values

        if (workTimeData.length === 0) {
            console.warn("No valid work hour data available.");
            return;
        }

        new Chart(ctx, {
            type: "polarArea",
            data: {
                labels: ["12", "3", "6", "9", "12"], // ✅ Clock Labels
                datasets: workTimeData
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true },
                    tooltip: { enabled: true }
                }
            }
        });
    });
</script>



